<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureAuth | Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS styles remain the same as in the original file */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
            --gray: #adb5bd;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --bounce: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            color: var(--dark);
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background particles */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
            }
            33% {
                transform: translateY(-30px) translateX(20px) rotate(120deg);
            }
            66% {
                transform: translateY(20px) translateX(-20px) rotate(240deg);
            }
            100% {
                transform: translateY(0) translateX(0) rotate(360deg);
            }
        }

        /* Transition particles */
        .transition-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            z-index: 100;
        }

        .container {
            position: relative;
            width: 1000px;
            max-width: 100%;
            min-height: 650px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            display: flex;
            animation: containerAppear 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            transform: translateY(20px);
            opacity: 0;
            transition: filter 0.3s ease;
        }

        @keyframes containerAppear {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .forms-container {
            width: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.85);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            transition: var(--bounce);
            opacity: 1;
            transform: translateX(0);
        }

        .auth-form.hidden {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            transform: translateX(100px);
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-title {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: 700;
        }

        .form-description {
            color: var(--gray);
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        /* Profile Avatar Preview */
        .avatar-preview {
            display: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 3px solid var(--primary);
            animation: fadeInUp 0.5s ease;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Enhanced Input Groups with Floating Labels */
        .input-group {
            position: relative;
            display: flex;
            flex-direction: column;
            margin-bottom: 25px;
            width: 100%;
            animation: fadeInUp 0.6s 0.3s both;
        }

        .input-group:nth-child(2) {
            animation-delay: 0.4s;
        }
        
        .input-group:nth-child(3) {
            animation-delay: 0.5s;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .input-wrapper:focus-within {
            transform: translateY(-2px);
        }

        .input-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            pointer-events: none;
            transition: var(--transition);
            z-index: 2;
        }

        .input-icon.left-icon {
            left: 15px;
        }

        .input-icon.right-icon {
            right: 15px;
            cursor: pointer;
            pointer-events: auto;
            z-index: 2;
        }

        .input-icon.right-icon:hover {
            color: var(--primary);
            transform: translateY(-50%) scale(1.1);
        }

        .input-field {
            width: 100%;
            padding: 16px 45px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            height: 54px;
            font-size: 1rem;
            background-color: rgba(248, 249, 250, 0.9);
            outline: none;
            transition: var(--transition);
            position: relative;
            z-index: 1;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .input-field:focus {
            border-color: var(--primary);
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .input-field:focus + .input-icon {
            color: var(--primary);
        }

        .input-field.error {
            border-color: var(--danger);
            animation: shake 0.5s ease-in-out;
            box-shadow: 0 0 8px rgba(230, 57, 70, 0.3);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Password Entry Animation */
        .password-bubbles {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .password-bubble {
            position: absolute;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0;
            animation: bubble-fade 0.8s forwards;
        }

        @keyframes bubble-fade {
            0% {
                transform: scale(0);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }

        /* Password Generator Button */
        .password-generator {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
            margin-top: 8px;
            padding: 5px 0;
            text-align: left;
        }

        .password-generator-line1 {
            font-size: 0.85rem;
            color: var(--dark);
        }

        .password-generator-line2 {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            padding: 0;
            text-align: left;
            font-weight: 500;
            position: relative;
        }

        .password-generator-line2:hover {
            color: var(--primary-dark);
        }

        .password-generator-line2::after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: -1px;
            left: 0;
            background-color: var(--primary);
            transition: var(--transition);
        }

        .password-generator-line2:hover::after {
            width: 100%;
        }

        /* Enhanced Button with Ripple Effect */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            outline: none;
            border-radius: 12px;
            cursor: pointer;
            background-color: var(--primary);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition);
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s 0.6s both;
        }

        .btn::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, rgba(255,255,255,0.3) 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10,10);
            opacity: 0;
            transition: transform .5s, opacity 1s;
        }

        .btn:active::after {
            transform: scale(0,0);
            opacity: 0.3;
            transition: 0s;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-ghost {
            background-color: transparent;
            border: 2px solid var(--light);
            color: white;
            animation: fadeInUp 0.6s 0.8s both;
        }

        .btn-ghost:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        /* Grey button for captcha refresh */
        .btn-grey {
            background-color: #6c757d;
            border: 2px solid #6c757d;
            color: white;
        }

        .btn-grey:hover {
            background-color: #5a6268;
            border-color: #5a6268;
        }

        .social-auth {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            animation: fadeInUp 0.6s 0.7s both;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            transition: var(--bounce);
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .social-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .social-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .social-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin: 15px 0;
            font-size: 0.9rem;
            animation: fadeInUp 0.6s 0.5s both;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        /* FIXED Toggle Switch with X and Check - Completely Fixed */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e9ecef;
            border-radius: 34px;
            transition: var(--transition);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: var(--bounce);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-x, .toggle-check {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: bold;
            transition: var(--transition);
            z-index: 3;
            pointer-events: none;
        }

        /* Centered X and Check icons */
        .toggle-x {
            left: 8px;
            color: var(--danger);
            opacity: 1;
        }

        .toggle-check {
            right: 8px;
            color: var(--success);
            opacity: 0;
        }

        /* ==== FIXED TOGGLE SLIDER OFFSETS ==== */
        /* Login slider – moves 25px when active */
        .toggle-login input:checked + .toggle-slider:before {
            transform: translateX(25px);
        }

        .toggle-login input:checked + .toggle-slider {
            background-color: var(--success);
        }

        /* Registration slider – moves 25px when active */
        .toggle-register input:checked + .toggle-slider:before {
            transform: translateX(25px);
        }

        .toggle-register input:checked + .toggle-slider {
            background-color: var(--success);
        }

        /* Common checked state styles for both toggles */
        input:checked + .toggle-slider .toggle-x {
            opacity: 0;
        }

        input:checked + .toggle-slider .toggle-check {
            opacity: 1;
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .forgot-password {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            cursor: pointer;
        }

        .forgot-password::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: var(--primary);
            transition: var(--transition);
        }

        .forgot-password:hover::after {
            width: 100%;
        }

        .forgot-password:hover {
            text-decoration: none;
        }

        .welcome-container {
            width: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .welcome-container::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            top: -50%;
            left: -50%;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .welcome-content {
            max-width: 400px;
            z-index: 1;
            animation: fadeInUp 0.8s 0.3s both;
        }

        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .welcome-description {
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Improved Password Strength Meter */
        .password-strength {
            width: 100%;
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            border-radius: 3px;
            transition: var(--bounce);
            background-color: var(--danger); /* Default to weak */
        }

        .strength-very-weak {
            background-color: var(--danger);
            width: 20%;
        }

        .strength-weak {
            background-color: #ff6b6b;
            width: 40%;
        }

        .strength-medium {
            background-color: var(--warning);
            width: 60%;
        }

        .strength-strong {
            background-color: #4cd964;
            width: 80%;
        }

        .strength-very-strong {
            background-color: var(--success);
            width: 100%;
        }

        .password-requirements {
            font-size: 0.75rem;
            color: var(--gray);
            text-align: left;
            margin-top: 8px;
            transition: var(--transition);
        }

        .requirement {
            display: flex;
            align-items: center;
            margin: 4px 0;
            transition: var(--transition);
        }

        .requirement i {
            margin-right: 5px;
            font-size: 0.7rem;
            transition: var(--transition);
        }

        .requirement.met {
            color: var(--success);
            transform: translateX(5px);
        }

        .requirement.met i {
            transform: scale(1.2);
        }

        /* Character Counter */
        .char-counter {
            font-size: 0.75rem;
            text-align: right;
            margin-top: 5px;
            color: var(--gray);
            transition: var(--transition);
        }

        .char-counter.near-limit {
            color: var(--warning);
        }

        .char-counter.over-limit {
            color: var(--danger);
        }

        /* Progressive Password Hints */
        .password-hint {
            font-size: 0.8rem;
            margin-top: 5px;
            color: var(--gray);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .password-hint.show {
            color: var(--primary);
            transform: translateY(2px);
        }

        /* Math Captcha */
        .captcha-container {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.5s ease;
            position: relative;
            z-index: 10;
        }

        .captcha-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9;
        }

        .captcha-question {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .captcha-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .captcha-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .captcha-actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .captcha-actions .btn {
            flex: 1;
            margin: 0;
        }

        /* Captcha Interruption Message */
        .captcha-interruption {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.5s ease;
            position: relative;
            z-index: 10;
        }

        .captcha-interruption p {
            margin-bottom: 15px;
            color: var(--dark);
        }

        /* Enhanced Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background-color: white;
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            z-index: 1000;
            transform: translateX(150%);
            transition: var(--bounce);
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
            animation: toastBounce 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes toastBounce {
            0% { transform: translateX(150%); }
            70% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        .toast i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        /* Enhanced Terms and Conditions */
        .terms {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 15px 0;
            font-size: 0.85rem;
            text-align: left;
            width: 100%;
            animation: fadeInUp 0.6s 0.6s both;
            cursor: pointer;
        }

        .terms-label {
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .terms a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }

        .terms a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: -1px;
            left: 0;
            background-color: var(--primary);
            transition: var(--transition);
        }

        .terms a:hover::after {
            width: 100%;
        }

        .terms a:hover {
            text-decoration: none;
        }

        /* Error Message */
        .error-message {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Copy Protection Overlay */
        .copy-protection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            pointer-events: none;
        }

        /* Responsive Design */
        @media (max-width: 870px) {
            .container {
                flex-direction: column;
                min-height: auto;
            }

            .forms-container, .welcome-container {
                width: 100%;
                padding: 30px 20px;
            }

            .welcome-container {
                order: -1;
                padding: 30px 20px;
            }

            .welcome-title {
                font-size: 2rem;
            }
        }

        /* Forgot Password Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(5px);
            transition: backdrop-filter 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .forgot-password-modal {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            animation: modalAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            transform: translateY(20px);
            opacity: 0;
        }

        @keyframes modalAppear {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .modal-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 700;
            text-align: center;
            width: 100%;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        .close-modal:hover {
            color: var(--dark);
            background-color: rgba(0, 0, 0, 0.05);
        }

        .modal-description {
            color: var(--gray);
            margin-bottom: 25px;
            text-align: center;
        }

        .blurred {
            filter: blur(5px);
            pointer-events: none;
        }

        /* Loading Button */
        .btn-loading {
            pointer-events: none;
            background-color: var(--primary-dark);
        }

        .btn-loading i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Date of Birth Calendar - FIXED */
        .dob-calendar {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000; /* Very high z-index to ensure it's on top */
            padding: 15px;
            animation: fadeInUp 0.3s ease;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            text-align: center;
            padding: 8px 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background-color: var(--primary);
            color: white;
        }

        .calendar-day.disabled {
            color: var(--gray);
            cursor: not-allowed;
        }

        .calendar-day.disabled:hover {
            background-color: transparent;
            color: var(--gray);
        }

        .calendar-day.selected {
            background-color: var(--primary);
            color: white;
        }

        .calendar-nav {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--primary);
            transition: var(--transition);
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .calendar-month-year {
            font-weight: 600;
        }

        /* Calendar icon styling */
        .input-icon.calendar-icon {
            pointer-events: auto;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>
    
    <div class="copy-protection" id="copyProtection"></div>
    
    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotPasswordModal">
        <div class="forgot-password-modal">
            <div class="modal-header">
                <h2 class="modal-title">Reset Your Password</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <p class="modal-description">Enter your details to receive a password reset link</p>
            
            <form id="forgotPasswordForm">
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-user"></i>
                        <input type="text" class="input-field" placeholder="Full Name" id="forgotFullName" required maxlength="128">
                    </div>
                    <div class="error-message" id="forgotFullNameError">Please enter your full name</div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-at"></i>
                        <input type="text" class="input-field" placeholder="Username" id="forgotUsername" required maxlength="25">
                    </div>
                    <div class="error-message" id="forgotUsernameError">Please enter your username</div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-envelope"></i>
                        <input type="email" class="input-field" placeholder="Email Address" id="forgotEmail" required maxlength="30">
                    </div>
                    <div class="error-message" id="forgotEmailError">Please enter a valid email address</div>
                </div>
                
                <button type="submit" class="btn" id="forgotPasswordSubmit">
                    <i class="fas fa-paper-plane"></i>
                    Send Password Reset Link
                </button>
            </form>
        </div>
    </div>
    
    <div class="container" id="container">
        <div class="forms-container">
            <form class="auth-form" id="signInForm">
                <div class="form-header">
                    <h2 class="form-title">Welcome Back</h2>
                    <p class="form-description">Sign in to your account to continue</p>
                </div>
                
                <!-- Profile Avatar Preview -->
                <div class="avatar-preview" id="loginAvatarPreview">
                    <img id="loginAvatarImg" src="" alt="Profile Avatar">
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-user"></i>
                        <input type="text" class="input-field" placeholder="Username or Email" id="loginUsername" required maxlength="30">
                    </div>
                    <div class="error-message" id="loginUsernameError">Please enter your username or email</div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-lock"></i>
                        <input type="password" class="input-field" placeholder="Password" id="loginPassword" required maxlength="25">
                        <i class="input-icon right-icon fas fa-eye" id="toggleLoginPassword"></i>
                        <div class="password-bubbles" id="loginPasswordBubbles"></div>
                    </div>
                    <div class="error-message" id="loginPasswordError">Please enter your password</div>
                    <div class="char-counter" id="loginPasswordCounter">0/25</div>
                </div>
                
                <div class="remember-forgot">
                    <label class="remember-me">
                        <span class="toggle-switch toggle-login">
                            <input type="checkbox" id="rememberMe">
                            <span class="toggle-slider">
                                <span class="toggle-x">✕</span>
                                <span class="toggle-check">✓</span>
                            </span>
                        </span>
                        <span>Remember me</span>
                    </label>
                    <a class="forgot-password" id="forgotPassword">Forgot password?</a>
                </div>
                
                <!-- Math Captcha for Login -->
                <div class="captcha-overlay" id="loginCaptchaOverlay"></div>
                <div class="captcha-container" id="loginCaptcha">
                    <div class="captcha-question" id="loginCaptchaQuestion"></div>
                    <input type="number" class="captcha-input" id="loginCaptchaAnswer" placeholder="Enter answer">
                    <div class="captcha-actions">
                        <button type="button" class="btn" id="loginCaptchaSubmit">Submit</button>
                        <button type="button" class="btn btn-grey" id="loginCaptchaRefresh">Refresh</button>
                    </div>
                </div>
                
                <!-- Captcha Interruption Message -->
                <div class="captcha-interruption" id="loginCaptchaInterruption">
                    <p>Sorry, activity was detected off of the captcha window!</p>
                    <button type="button" class="btn" id="loginCaptchaTryAgain">Try again?</button>
                </div>
                
                <button type="submit" class="btn" id="loginSubmit">
                    <i class="fas fa-sign-in-alt"></i>
                    Sign In
                </button>
                
                <div class="social-auth" id="socialAuth">
                    <!-- Social buttons will be dynamically generated here -->
                </div>
            </form>
            
            <form class="auth-form hidden" id="signUpForm">
                <div class="form-header">
                    <h2 class="form-title">Create Account</h2>
                    <p class="form-description">Sign up to get started with our service</p>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-user"></i>
                        <input type="text" class="input-field" placeholder="Full Name" id="fullName" required maxlength="128">
                    </div>
                    <div class="error-message" id="fullNameError">Please enter your full name (first and last name)</div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-envelope"></i>
                        <input type="email" class="input-field" placeholder="Email Address" id="email" required maxlength="30">
                    </div>
                    <div class="error-message" id="emailError">Please enter a valid email address</div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-at"></i>
                        <input type="text" class="input-field" placeholder="Username" id="username" required maxlength="25">
                    </div>
                    <div class="error-message" id="usernameError">Please enter a username</div>
                </div>
                
                <!-- Date of Birth Input -->
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-calendar-alt calendar-icon" id="dobCalendar"></i>
                        <input type="text" class="input-field" placeholder="Date of Birth (DD/MM/YYYY)" id="dob" required maxlength="10">
                    </div>
                    <div class="error-message" id="dobError">You must be between 13 and 100 years old to register</div>
                    <div class="dob-calendar" id="dobCalendarPicker"></div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-lock"></i>
                        <input type="password" class="input-field" placeholder="Password" id="password" required maxlength="25">
                        <i class="input-icon right-icon fas fa-eye" id="togglePassword"></i>
                        <div class="password-bubbles" id="passwordBubbles"></div>
                    </div>
                    <div class="password-strength">
                        <div class="password-strength-bar" id="passwordStrengthBar"></div>
                    </div>
                    <div class="password-requirements">
                        <div class="requirement" id="lengthReq">
                            <i class="fas fa-times"></i> At least 8 characters
                        </div>
                        <div class="requirement" id="upperReq">
                            <i class="fas fa-times"></i> One uppercase letter
                        </div>
                        <div class="requirement" id="lowerReq">
                            <i class="fas fa-times"></i> One lowercase letter
                        </div>
                        <div class="requirement" id="numberReq">
                            <i class="fas fa-times"></i> One number
                        </div>
                        <div class="requirement" id="symbolReq">
                            <i class="fas fa-times"></i> One symbol
                        </div>
                        <div class="requirement" id="spaceReq">
                            <i class="fas fa-times"></i> No spaces allowed
                        </div>
                    </div>
                    <div class="password-hint" id="passwordHint"></div>
                    <div class="char-counter" id="passwordCounter">0/25</div>
                    <div class="error-message" id="passwordError">Please enter a strong password</div>
                    
                    <!-- Password Generator Button -->
                    <div class="password-generator">
                        <div class="password-generator-line1">Can't think of a strong password?</div>
                        <button type="button" class="password-generator-line2" id="passwordGenerator">We can generate a strong one for you!</button>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-wrapper">
                        <i class="input-icon left-icon fas fa-lock"></i>
                        <input type="password" class="input-field" placeholder="Confirm Password" id="confirmPassword" required maxlength="25">
                        <i class="input-icon right-icon fas fa-eye" id="toggleConfirmPassword"></i>
                        <div class="password-bubbles" id="confirmPasswordBubbles"></div>
                    </div>
                    <div class="char-counter" id="confirmPasswordCounter">0/25</div>
                    <div class="error-message" id="confirmPasswordError">Passwords do not match</div>
                </div>
                
                <!-- FIXED TERMS AND CONDITIONS SECTION -->
                <div class="terms">
                    <label class="terms-label">
                        <span class="toggle-switch toggle-register">
                            <input type="checkbox" id="agreeTerms" required>
                            <span class="toggle-slider">
                                <span class="toggle-x">✕</span>
                                <span class="toggle-check">✓</span>
                            </span>
                        </span>
                        <span>I agree to the <a href="#">Terms and Conditions</a> and <a href="#">Privacy Policy</a></span>
                    </label>
                </div>
                <div class="error-message" id="termsError">You must agree to the terms and conditions</div>
                
                <!-- Math Captcha for Registration -->
                <div class="captcha-overlay" id="registerCaptchaOverlay"></div>
                <div class="captcha-container" id="registerCaptcha">
                    <div class="captcha-question" id="registerCaptchaQuestion"></div>
                    <input type="number" class="captcha-input" id="registerCaptchaAnswer" placeholder="Enter answer">
                    <div class="captcha-actions">
                        <button type="button" class="btn" id="registerCaptchaSubmit">Submit</button>
                        <button type="button" class="btn btn-grey" id="registerCaptchaRefresh">Refresh</button>
                    </div>
                </div>
                
                <!-- Captcha Interruption Message -->
                <div class="captcha-interruption" id="registerCaptchaInterruption">
                    <p>Sorry, activity was detected off of the captcha window!</p>
                    <button type="button" class="btn" id="registerCaptchaTryAgain">Try again?</button>
                </div>
                
                <button type="submit" class="btn" id="registerSubmit">
                    <i class="fas fa-user-plus"></i>
                    Create Account
                </button>
                
                <div class="social-auth" id="socialAuthRegister">
                    <!-- Social buttons will be dynamically generated here -->
                </div>
            </form>
        </div>
        
        <div class="welcome-container">
            <div class="welcome-content">
                <h2 class="welcome-title" id="welcomeTitle">New Here?</h2>
                <h2 class="welcome-title" id="welcomeTitle2" style="display:none">Welcome Back!</h2>
                <p class="welcome-description" id="welcomeDescription">Sign up and discover a great amount of new opportunities!</p>
                <p class="welcome-description" id="welcomeDescription2" style="display:none">To keep connected with us please login with your personal info</p>
                
                <button class="btn btn-ghost" id="switchFormButton">
                    Sign Up
                </button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Operation completed successfully!</span>
    </div>

    <script>
        // =============================================
        // CONFIGURATION
        // =============================================
        
        // Age restrictions for registration
        const MINIMUM_AGE = 13;
        const MAXIMUM_AGE = 100;
        
        // SOCIAL LOGIN CONFIGURATION
        // Social Google - Google OAuth integration
        // enabled = true
        const socialGoogle = {
            enabled: true,
            name: "Google",
            icon: "fab fa-google",
            color: "linear-gradient(135deg, #dd4b39, #e05d4e)",
            authUrl: "#", // Replace with actual Google OAuth URL
            note: "Social Google - Google OAuth integration"
        };
        
        // Social Apple - Apple ID integration
        // enabled = true
        const socialApple = {
            enabled: true,
            name: "Apple",
            icon: "fab fa-apple",
            color: "linear-gradient(135deg, #000000, #434343)",
            authUrl: "#", // Replace with actual Apple ID URL
            note: "Social Apple - Apple ID integration"
        };
        
        // Social Facebook - Facebook Login integration
        // enabled = false
        const socialFacebook = {
            enabled: false,
            name: "Facebook",
            icon: "fab fa-facebook-f",
            color: "linear-gradient(135deg, #3b5998, #4a6bbb)",
            authUrl: "#", // Replace with actual Facebook Login URL
            note: "Social Facebook - Facebook Login integration"
        };
        
        // Social Twitter - Twitter OAuth integration
        // enabled = false
        const socialTwitter = {
            enabled: false,
            name: "Twitter",
            icon: "fab fa-twitter",
            color: "linear-gradient(135deg, #1da1f2, #3ab1f5)",
            authUrl: "#", // Replace with actual Twitter OAuth URL
            note: "Social Twitter - Twitter OAuth integration"
        };
        
        // Social GitHub - GitHub OAuth integration
        // enabled = false
        const socialGitHub = {
            enabled: false,
            name: "GitHub",
            icon: "fab fa-github",
            color: "linear-gradient(135deg, #333333, #555555)",
            authUrl: "#", // Replace with actual GitHub OAuth URL
            note: "Social GitHub - GitHub OAuth integration"
        };
        
        // Social LinkedIn - LinkedIn OAuth integration
        // enabled = false
        const socialLinkedIn = {
            enabled: false,
            name: "LinkedIn",
            icon: "fab fa-linkedin-in",
            color: "linear-gradient(135deg, #0077b5, #00a0dc)",
            authUrl: "#", // Replace with actual LinkedIn OAuth URL
            note: "Social LinkedIn - LinkedIn OAuth integration"
        };
        
        // Social Microsoft - Microsoft Account integration
        // enabled = false
        const socialMicrosoft = {
            enabled: false,
            name: "Microsoft",
            icon: "fab fa-microsoft",
            color: "linear-gradient(135deg, #00a4ef, #0078d7)",
            authUrl: "#", // Replace with actual Microsoft Account URL
            note: "Social Microsoft - Microsoft Account integration"
        };
        
        // Array of all social login options
        const socialLoginOptions = [
            socialGoogle,
            socialApple,
            socialFacebook,
            socialTwitter,
            socialGitHub,
            socialLinkedIn,
            socialMicrosoft
        ];
        
        // Function to generate social login buttons
        function generateSocialButtons(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Clear existing buttons
            
            // Filter enabled social logins
            const enabledSocialLogins = socialLoginOptions.filter(option => option.enabled);
            
            // Create buttons for enabled social logins
            enabledSocialLogins.forEach(option => {
                const button = document.createElement('div');
                button.className = 'social-btn';
                button.style.background = option.color;
                button.setAttribute('data-platform', option.name.toLowerCase());
                button.innerHTML = `<i class="${option.icon}"></i>`;
                
                // Add click event
                button.addEventListener('click', function() {
                    handleSocialLogin(option.name);
                });
                
                container.appendChild(button);
            });
            
            // If no social logins are enabled, hide the container
            if (enabledSocialLogins.length === 0) {
                container.style.display = 'none';
            } else {
                container.style.display = 'flex';
            }
        }
        
        // Function to handle social login clicks
        function handleSocialLogin(platform) {
            // In a real application, this would redirect to the OAuth provider
            // For demo purposes, we'll just show a toast message
            showToast(`${platform} authentication would be triggered here`, 'success');
            
            // Example of actual OAuth flow (commented out for demo):
            // window.location.href = getAuthUrlForPlatform(platform);
        }
        
        // Function to get the actual OAuth URL for a platform
        function getAuthUrlForPlatform(platform) {
            const option = socialLoginOptions.find(opt => opt.name === platform);
            return option ? option.authUrl : '#';
        }

        // Generate animated background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // Random properties
                const size = Math.random() * 100 + 20;
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const animationDelay = Math.random() * 20;
                const opacity = Math.random() * 0.2 + 0.05;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${posX}%`;
                particle.style.top = `${posY}%`;
                particle.style.opacity = opacity;
                particle.style.animationDelay = `${animationDelay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Copy protection - disable text selection and copying for UI elements only
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // Generate social buttons for both login and registration forms
            generateSocialButtons('socialAuth');
            generateSocialButtons('socialAuthRegister');
            
            // Disable right-click context menu
            document.addEventListener('contextmenu', function(e) {
                if (!e.target.classList.contains('input-field') || e.target.type === 'password') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Disable text selection for UI elements
            document.addEventListener('selectstart', function(e) {
                if (!e.target.classList.contains('input-field') || e.target.type === 'password') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Disable copy for UI elements and password fields
            document.addEventListener('copy', function(e) {
                if (!e.target.classList.contains('input-field') || e.target.type === 'password') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Disable cut for UI elements and password fields
            document.addEventListener('cut', function(e) {
                if (!e.target.classList.contains('input-field') || e.target.type === 'password') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Disable drag and drop for UI elements
            document.addEventListener('dragstart', function(e) {
                if (!e.target.classList.contains('input-field') || e.target.type === 'password') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Load remembered username if available
            loadRememberedUsername();
            
            // Focus password field if username is prefilled
            if (loginUsernameInput.value) {
                loginPasswordInput.focus();
            }
            
            // Initialize date of birth calendar
            initializeDOBCalendar();
        });

        // DOM Elements
        const switchFormButton = document.getElementById('switchFormButton');
        const container = document.getElementById('container');
        const signInForm = document.getElementById('signInForm');
        const signUpForm = document.getElementById('signUpForm');
        const welcomeTitle = document.getElementById('welcomeTitle');
        const welcomeTitle2 = document.getElementById('welcomeTitle2');
        const welcomeDescription = document.getElementById('welcomeDescription');
        const welcomeDescription2 = document.getElementById('welcomeDescription2');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        
        // Password Toggle Elements
        const togglePassword = document.getElementById('togglePassword');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const toggleLoginPassword = document.getElementById('toggleLoginPassword');
        
        // Password Strength Elements
        const passwordInput = document.getElementById('password');
        const passwordStrengthBar = document.getElementById('passwordStrengthBar');
        const lengthReq = document.getElementById('lengthReq');
        const upperReq = document.getElementById('upperReq');
        const lowerReq = document.getElementById('lowerReq');
        const numberReq = document.getElementById('numberReq');
        const symbolReq = document.getElementById('symbolReq');
        const spaceReq = document.getElementById('spaceReq');
        const passwordHint = document.getElementById('passwordHint');
        
        // Password Bubble Elements
        const passwordBubbles = document.getElementById('passwordBubbles');
        const confirmPasswordBubbles = document.getElementById('confirmPasswordBubbles');
        const loginPasswordBubbles = document.getElementById('loginPasswordBubbles');
        
        // Character Counters
        const passwordCounter = document.getElementById('passwordCounter');
        const confirmPasswordCounter = document.getElementById('confirmPasswordCounter');
        const loginPasswordCounter = document.getElementById('loginPasswordCounter');
        
        // Validation Elements
        const fullNameInput = document.getElementById('fullName');
        const fullNameError = document.getElementById('fullNameError');
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        const usernameInput = document.getElementById('username');
        const usernameError = document.getElementById('usernameError');
        const dobInput = document.getElementById('dob');
        const dobError = document.getElementById('dobError');
        const dobCalendarIcon = document.getElementById('dobCalendar');
        const dobCalendarPicker = document.getElementById('dobCalendarPicker');
        const passwordError = document.getElementById('passwordError');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        const loginUsernameInput = document.getElementById('loginUsername');
        const loginUsernameError = document.getElementById('loginUsernameError');
        const loginPasswordInput = document.getElementById('loginPassword');
        const loginPasswordError = document.getElementById('loginPasswordError');
        const termsError = document.getElementById('termsError');
        
        // Avatar Preview Elements
        const loginAvatarPreview = document.getElementById('loginAvatarPreview');
        const loginAvatarImg = document.getElementById('loginAvatarImg');
        
        // Forgot Password Modal Elements
        const forgotPasswordModal = document.getElementById('forgotPasswordModal');
        const forgotPasswordLink = document.getElementById('forgotPassword');
        const closeModal = document.getElementById('closeModal');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const forgotFullNameInput = document.getElementById('forgotFullName');
        const forgotFullNameError = document.getElementById('forgotFullNameError');
        const forgotUsernameInput = document.getElementById('forgotUsername');
        const forgotUsernameError = document.getElementById('forgotUsernameError');
        const forgotEmailInput = document.getElementById('forgotEmail');
        const forgotEmailError = document.getElementById('forgotEmailError');
        const forgotPasswordSubmit = document.getElementById('forgotPasswordSubmit');
        
        // Password Generator
        const passwordGenerator = document.getElementById('passwordGenerator');
        
        // Captcha Elements
        const loginCaptcha = document.getElementById('loginCaptcha');
        const loginCaptchaOverlay = document.getElementById('loginCaptchaOverlay');
        const loginCaptchaQuestion = document.getElementById('loginCaptchaQuestion');
        const loginCaptchaAnswer = document.getElementById('loginCaptchaAnswer');
        const loginCaptchaSubmit = document.getElementById('loginCaptchaSubmit');
        const loginCaptchaRefresh = document.getElementById('loginCaptchaRefresh');
        const loginCaptchaInterruption = document.getElementById('loginCaptchaInterruption');
        const loginCaptchaTryAgain = document.getElementById('loginCaptchaTryAgain');
        
        const registerCaptcha = document.getElementById('registerCaptcha');
        const registerCaptchaOverlay = document.getElementById('registerCaptchaOverlay');
        const registerCaptchaQuestion = document.getElementById('registerCaptchaQuestion');
        const registerCaptchaAnswer = document.getElementById('registerCaptchaAnswer');
        const registerCaptchaSubmit = document.getElementById('registerCaptchaSubmit');
        const registerCaptchaRefresh = document.getElementById('registerCaptchaRefresh');
        const registerCaptchaInterruption = document.getElementById('registerCaptchaInterruption');
        const registerCaptchaTryAgain = document.getElementById('registerCaptchaTryAgain');
        
        const loginSubmit = document.getElementById('loginSubmit');
        const registerSubmit = document.getElementById('registerSubmit');
        
        // Terms and Conditions Toggle
        const agreeTerms = document.getElementById('agreeTerms');
        
        // Form State
        let isSignUpActive = false;
        let loginCaptchaCorrectAnswer = 0;
        let registerCaptchaCorrectAnswer = 0;
        let isCaptchaActive = false;
        let activeCaptchaType = null; // 'login' or 'register'

        // Date of Birth Calendar State
        let currentCalendarDate = new Date();
        let selectedCalendarDate = null;
        let calendarVisible = false;

        // Event Listeners
        switchFormButton.addEventListener('click', toggleForms);
        
        // Forgot Password Modal
        forgotPasswordLink.addEventListener('click', openForgotPasswordModal);
        closeModal.addEventListener('click', closeForgotPasswordModal);
        
        // Close modal when clicking outside
        forgotPasswordModal.addEventListener('click', function(e) {
            if (e.target === forgotPasswordModal) {
                closeForgotPasswordModal();
            }
        });
        
        // Forgot Password Form Submission
        forgotPasswordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading state
            setButtonLoading(forgotPasswordSubmit, true);
            
            setTimeout(() => {
                const fullName = forgotFullNameInput.value.trim();
                const username = forgotUsernameInput.value.trim();
                const email = forgotEmailInput.value.trim();
                
                // Validate all fields
                let isValid = true;
                
                if (!validateForgotFullName()) isValid = false;
                if (!validateForgotUsername()) isValid = false;
                if (!validateForgotEmail()) isValid = false;
                
                if (isValid) {
                    showToast('Password reset link has been sent to your email!', 'success');
                    closeForgotPasswordModal();
                } else {
                    showToast('Please fix the errors in the form', 'error');
                }
                
                // Remove loading state
                setButtonLoading(forgotPasswordSubmit, false);
            }, 1500);
        });
        
        // Terms and Conditions Toggle Event
        agreeTerms.addEventListener('change', function() {
            if (this.checked) {
                termsError.style.display = 'none';
            }
        });
        
        // Toggle Forms with enhanced animation
        function toggleForms() {
            isSignUpActive = !isSignUpActive;
            
            // Create transition particles
            createTransitionParticles();
            
            // Apply haptic feedback if available
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
            
            setTimeout(() => {
                if (isSignUpActive) {
                    signInForm.classList.add('hidden');
                    setTimeout(() => {
                        signUpForm.classList.remove('hidden');
                    }, 200);
                    switchFormButton.textContent = 'Sign In';
                    welcomeTitle.style.display = 'none';
                    welcomeTitle2.style.display = 'block';
                    welcomeDescription.style.display = 'none';
                    welcomeDescription2.style.display = 'block';
                    document.title = 'SecureAuth | Register';
                } else {
                    signUpForm.classList.add('hidden');
                    setTimeout(() => {
                        signInForm.classList.remove('hidden');
                    }, 200);
                    switchFormButton.textContent = 'Sign Up';
                    welcomeTitle.style.display = 'block';
                    welcomeTitle2.style.display = 'none';
                    welcomeDescription.style.display = 'block';
                    welcomeDescription2.style.display = 'none';
                    document.title = 'SecureAuth | Login';
                }
            }, 300);
        }
        
        // Create particle transition effect
        function createTransitionParticles() {
            const particlesCount = 30;
            const containerRect = container.getBoundingClientRect();
            
            for (let i = 0; i < particlesCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('transition-particle');
                
                // Random position within the container
                const x = Math.random() * containerRect.width;
                const y = Math.random() * containerRect.height;
                
                // Random size and color
                const size = Math.random() * 8 + 4;
                const colors = ['#4361ee', '#3a0ca3', '#f72585', '#4cc9f0'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.backgroundColor = color;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                
                document.body.appendChild(particle);
                
                // Animate particle
                const targetX = Math.random() * window.innerWidth;
                const targetY = Math.random() * window.innerHeight;
                const duration = Math.random() * 1000 + 500;
                
                particle.animate([
                    { 
                        transform: 'translate(0, 0) scale(1)',
                        opacity: 1
                    },
                    { 
                        transform: `translate(${targetX - x}px, ${targetY - y}px) scale(0)`,
                        opacity: 0
                    }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });
                
                // Remove particle after animation
                setTimeout(() => {
                    particle.remove();
                }, duration);
            }
        }
        
        // Forgot Password Modal Functions
        function openForgotPasswordModal() {
            forgotPasswordModal.classList.add('active');
            container.classList.add('blurred');
            document.title = 'SecureAuth | Password Reset';
        }
        
        function closeForgotPasswordModal() {
            forgotPasswordModal.classList.remove('active');
            container.classList.remove('blurred');
            
            // Reset to appropriate title based on current form
            if (isSignUpActive) {
                document.title = 'SecureAuth | Register';
            } else {
                document.title = 'SecureAuth | Login';
            }
        }
        
        // Forgot Password Validation Functions
        function validateForgotFullName() {
            const fullName = forgotFullNameInput.value.trim();
            const nameParts = fullName.split(' ').filter(part => part.length > 0);
            
            if (nameParts.length < 2 || nameParts[0].length < 2 || nameParts[1].length < 2) {
                forgotFullNameInput.classList.add('error');
                forgotFullNameError.style.display = 'block';
                return false;
            } else {
                forgotFullNameInput.classList.remove('error');
                forgotFullNameError.style.display = 'none';
                return true;
            }
        }
        
        function validateForgotUsername() {
            const username = forgotUsernameInput.value.trim();
            
            if (username.length < 3) {
                forgotUsernameInput.classList.add('error');
                forgotUsernameError.style.display = 'block';
                return false;
            } else {
                forgotUsernameInput.classList.remove('error');
                forgotUsernameError.style.display = 'none';
                return true;
            }
        }
        
        function validateForgotEmail() {
            const email = forgotEmailInput.value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!emailRegex.test(email)) {
                forgotEmailInput.classList.add('error');
                forgotEmailError.style.display = 'block';
                return false;
            } else {
                forgotEmailInput.classList.remove('error');
                forgotEmailError.style.display = 'none';
                return true;
            }
        }
        
        // Forgot Password Input Validation Events
        forgotFullNameInput.addEventListener('input', validateForgotFullName);
        forgotUsernameInput.addEventListener('input', validateForgotUsername);
        forgotEmailInput.addEventListener('input', validateForgotEmail);
        
        // Password Toggle Functionality (Hold to show)
        function setupPasswordToggle(toggleIcon, passwordInputId, bubblesElement) {
            const passwordInput = document.getElementById(passwordInputId);
            
            toggleIcon.addEventListener('mousedown', function() {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            });
            
            toggleIcon.addEventListener('mouseup', function() {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            });
            
            toggleIcon.addEventListener('mouseleave', function() {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            });
            
            // For touch devices
            toggleIcon.addEventListener('touchstart', function(e) {
                e.preventDefault();
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            });
            
            toggleIcon.addEventListener('touchend', function(e) {
                e.preventDefault();
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            });
            
            // Password bubble animation
            passwordInput.addEventListener('input', function() {
                createPasswordBubbles(bubblesElement, this.value.length);
                
                // If captcha is active and input changes, show interruption
                if (isCaptchaActive) {
                    if (activeCaptchaType === 'login' && passwordInputId === 'loginPassword') {
                        // Don't trigger for the active captcha input
                        return;
                    }
                    if (activeCaptchaType === 'register' && (passwordInputId === 'password' || passwordInputId === 'confirmPassword')) {
                        // Don't trigger for the active captcha input
                        return;
                    }
                    showCaptchaInterruption(activeCaptchaType);
                }
            });
        }
        
        // Create password bubbles animation
        function createPasswordBubbles(bubblesElement, charCount) {
            // Clear existing bubbles
            bubblesElement.innerHTML = '';
            
            if (charCount === 0) {
                bubblesElement.style.display = 'none';
                return;
            }
            
            bubblesElement.style.display = 'block';
            
            // Create bubbles based on character count
            for (let i = 0; i < charCount; i++) {
                const bubble = document.createElement('div');
                bubble.classList.add('password-bubble');
                
                // Random position within the input field
                const left = Math.random() * 80 + 10; // 10% to 90%
                const top = Math.random() * 60 + 20; // 20% to 80%
                
                // Random size and animation delay
                const size = Math.random() * 8 + 4;
                const delay = Math.random() * 0.5;
                
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${left}%`;
                bubble.style.top = `${top}%`;
                bubble.style.animationDelay = `${delay}s`;
                
                bubblesElement.appendChild(bubble);
                
                // Remove bubble after animation
                setTimeout(() => {
                    if (bubble.parentNode === bubblesElement) {
                        bubble.remove();
                    }
                }, 800);
            }
        }
        
        setupPasswordToggle(togglePassword, 'password', passwordBubbles);
        setupPasswordToggle(toggleConfirmPassword, 'confirmPassword', confirmPasswordBubbles);
        setupPasswordToggle(toggleLoginPassword, 'loginPassword', loginPasswordBubbles);
        
        // Password Generator
        passwordGenerator.addEventListener('click', function() {
            const generatedPassword = generateSecurePassword();
            passwordInput.value = generatedPassword;
            confirmPasswordInput.value = generatedPassword;
            
            // Trigger input events to update UI
            passwordInput.dispatchEvent(new Event('input'));
            confirmPasswordInput.dispatchEvent(new Event('input'));
            
            showToast('Strong password generated!', 'success');
        });
        
        function generateSecurePassword() {
            const length = 16;
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
            let password = "";
            
            // Ensure at least one of each required character type
            password += getRandomChar("abcdefghijklmnopqrstuvwxyz"); // lowercase
            password += getRandomChar("ABCDEFGHIJKLMNOPQRSTUVWXYZ"); // uppercase
            password += getRandomChar("0123456789"); // number
            password += getRandomChar("!@#$%^&*"); // symbol
            
            // Fill the rest
            for (let i = password.length; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            
            // Shuffle the password
            return password.split('').sort(() => 0.5 - Math.random()).join('');
        }
        
        function getRandomChar(chars) {
            return chars.charAt(Math.floor(Math.random() * chars.length));
        }
        
        // Improved Password Strength Checker
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            
            // Update character counter
            updateCharCounter(passwordCounter, password.length);
            
            // If password is empty, reset strength meter
            if (password.length === 0) {
                passwordStrengthBar.style.width = '0%';
                passwordStrengthBar.className = 'password-strength-bar';
                resetPasswordRequirements();
                passwordHint.textContent = '';
                passwordHint.classList.remove('show');
                return;
            }
            
            // Calculate password strength
            const strength = calculatePasswordStrength(password);
            
            // Update strength bar
            updatePasswordStrengthBar(strength);
            
            // Update requirement indicators
            updatePasswordRequirements(password);
            
            // Update password hint
            updatePasswordHint(password, strength);
            
            // Validate password in real-time
            validatePassword();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'register') {
                showCaptchaInterruption('register');
            }
        });
        
        // Improved Password Strength Calculation
        function calculatePasswordStrength(password) {
            let strength = 0;
            
            // Length factor (max 40 points)
            if (password.length >= 8) strength += 20;
            if (password.length >= 12) strength += 10;
            if (password.length >= 16) strength += 10;
            
            // Character variety (max 60 points)
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSymbol = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            
            // Each character type adds points
            if (hasUpper) strength += 15;
            if (hasLower) strength += 15;
            if (hasNumber) strength += 15;
            if (hasSymbol) strength += 15;
            
            // Bonus points for mixed case and numbers/symbols
            if (hasUpper && hasLower) strength += 5;
            if ((hasNumber || hasSymbol) && (hasUpper || hasLower)) strength += 5;
            
            // Penalty for common patterns
            if (/^[a-z]+$/.test(password) || /^[A-Z]+$/.test(password) || /^[0-9]+$/.test(password)) {
                strength = Math.max(0, strength - 20);
            }
            
            // Penalty for sequential characters (e.g., 123, abc)
            if (/(.)\1{2,}/.test(password) || /(012|123|234|345|456|567|678|789|abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz)/i.test(password)) {
                strength = Math.max(0, strength - 15);
            }
            
            // Penalty for common passwords
            const commonPasswords = ['password', '123456', 'qwerty', 'admin', 'welcome', 'password1'];
            if (commonPasswords.includes(password.toLowerCase())) {
                strength = 10;
            }
            
            return Math.min(100, Math.max(0, strength));
        }
        
        // Update Password Strength Bar
        function updatePasswordStrengthBar(strength) {
            passwordStrengthBar.style.width = `${strength}%`;
            
            // Remove all strength classes
            passwordStrengthBar.classList.remove(
                'strength-very-weak', 
                'strength-weak', 
                'strength-medium', 
                'strength-strong', 
                'strength-very-strong'
            );
            
            // Add appropriate strength class
            if (strength < 20) {
                passwordStrengthBar.classList.add('strength-very-weak');
            } else if (strength < 40) {
                passwordStrengthBar.classList.add('strength-weak');
            } else if (strength < 60) {
                passwordStrengthBar.classList.add('strength-medium');
            } else if (strength < 80) {
                passwordStrengthBar.classList.add('strength-strong');
            } else {
                passwordStrengthBar.classList.add('strength-very-strong');
            }
        }
        
        // Update Password Requirements
        function updatePasswordRequirements(password) {
            const hasLength = password.length >= 8;
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSymbol = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
            const hasNoSpaces = !/\s/.test(password);
            
            updateRequirement(lengthReq, hasLength);
            updateRequirement(upperReq, hasUpper);
            updateRequirement(lowerReq, hasLower);
            updateRequirement(numberReq, hasNumber);
            updateRequirement(symbolReq, hasSymbol);
            updateRequirement(spaceReq, hasNoSpaces);
        }
        
        // Reset Password Requirements
        function resetPasswordRequirements() {
            updateRequirement(lengthReq, false);
            updateRequirement(upperReq, false);
            updateRequirement(lowerReq, false);
            updateRequirement(numberReq, false);
            updateRequirement(symbolReq, false);
            updateRequirement(spaceReq, false);
        }
        
        // Progressive Password Hints
        function updatePasswordHint(password, strength) {
            if (password.length === 0) {
                passwordHint.textContent = '';
                passwordHint.classList.remove('show');
                return;
            }
            
            let hint = '';
            
            if (password.length < 8) {
                hint = 'Try making your password longer 📏';
            } else if (strength < 20) {
                hint = 'Very weak password. Try adding different character types 💡';
            } else if (strength < 40) {
                hint = 'Weak password. Mix uppercase, lowercase, numbers, and symbols 💪';
            } else if (strength < 60) {
                hint = 'Fair password. Consider adding more character variety 🔢';
            } else if (strength < 80) {
                hint = 'Strong password! Almost there, consider adding a symbol ✨';
            } else {
                hint = 'Excellent! Your password is very strong 🔒';
            }
            
            passwordHint.textContent = hint;
            passwordHint.classList.add('show');
        }
        
        // Character counter for all password fields
        function setupCharCounter(inputElement, counterElement) {
            inputElement.addEventListener('input', function() {
                updateCharCounter(counterElement, this.value.length);
            });
        }
        
        function updateCharCounter(counterElement, length) {
            counterElement.textContent = `${length}/25`;
            
            // Update color based on length
            if (length >= 23) {
                counterElement.classList.add('over-limit');
                counterElement.classList.remove('near-limit');
            } else if (length >= 20) {
                counterElement.classList.add('near-limit');
                counterElement.classList.remove('over-limit');
            } else {
                counterElement.classList.remove('near-limit', 'over-limit');
            }
        }
        
        // Initialize character counters
        setupCharCounter(passwordInput, passwordCounter);
        setupCharCounter(confirmPasswordInput, confirmPasswordCounter);
        setupCharCounter(loginPasswordInput, loginPasswordCounter);
        
        function updateRequirement(element, condition) {
            const icon = element.querySelector('i');
            if (condition) {
                element.classList.add('met');
                icon.className = 'fas fa-check';
            } else {
                element.classList.remove('met');
                icon.className = 'fas fa-times';
            }
        }
        
        // Profile Avatar Preview
        loginUsernameInput.addEventListener('input', function() {
            const username = this.value.trim();
            
            if (username.length > 2) {
                // In a real app, you would check if the account exists and fetch the avatar
                // For demo purposes, we'll simulate finding an account 70% of the time
                const accountFound = Math.random() > 0.3;
                
                if (accountFound) {
                    // Use Gravatar or similar service for demo
                    const email = username.includes('@') ? username : `${username}@example.com`;
                    const hash = md5(email.trim().toLowerCase());
                    const avatarUrl = `https://www.gravatar.com/avatar/${hash}?s=120&d=identicon`;
                    
                    loginAvatarImg.src = avatarUrl;
                    loginAvatarPreview.style.display = 'block';
                } else {
                    loginAvatarPreview.style.display = 'none';
                }
            } else {
                loginAvatarPreview.style.display = 'none';
            }
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'login') {
                showCaptchaInterruption('login');
            }
        });
        
        // Simple MD5 function for Gravatar (for demo purposes)
        function md5(input) {
            // This is a simplified version - in production, use a proper MD5 library
            return Array.from(input).reduce((hash, char) => {
                return ((hash << 5) - hash) + char.charCodeAt(0) | 0;
            }, 0).toString(16);
        }
        
        // Full Name Validation
        fullNameInput.addEventListener('input', function() {
            validateFullName();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'register') {
                showCaptchaInterruption('register');
            }
        });
        
        function validateFullName() {
            const fullName = fullNameInput.value.trim();
            // Check if there's at least one space and both parts have at least 2 characters
            const nameParts = fullName.split(' ').filter(part => part.length > 0);
            
            if (nameParts.length < 2 || nameParts[0].length < 2 || nameParts[1].length < 2) {
                fullNameInput.classList.add('error');
                fullNameError.style.display = 'block';
                return false;
            } else {
                fullNameInput.classList.remove('error');
                fullNameError.style.display = 'none';
                return true;
            }
        }
        
        // Email Validation
        emailInput.addEventListener('input', function() {
            validateEmail();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'register') {
                showCaptchaInterruption('register');
            }
        });
        
        function validateEmail() {
            const email = emailInput.value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!emailRegex.test(email)) {
                emailInput.classList.add('error');
                emailError.style.display = 'block';
                return false;
            } else {
                emailInput.classList.remove('error');
                emailError.style.display = 'none';
                return true;
            }
        }
        
        // Username Validation
        usernameInput.addEventListener('input', function() {
            validateUsername();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'register') {
                showCaptchaInterruption('register');
            }
        });
        
        function validateUsername() {
            const username = usernameInput.value.trim();
            
            if (username.length < 3) {
                usernameInput.classList.add('error');
                usernameError.style.display = 'block';
                return false;
            } else {
                usernameInput.classList.remove('error');
                usernameError.style.display = 'none';
                return true;
            }
        }
        
        // Date of Birth Validation and Calendar - FIXED
        function initializeDOBCalendar() {
            // Make calendar icon clickable
            dobCalendarIcon.style.pointerEvents = 'auto';
            dobCalendarIcon.style.cursor = 'pointer';
            
            // Toggle calendar visibility
            dobCalendarIcon.addEventListener('click', function(e) {
                e.stopPropagation(); // Prevent event from bubbling up
                if (calendarVisible) {
                    hideDOBCalendar();
                } else {
                    showDOBCalendar();
                }
            });
            
            // Close calendar when clicking outside
            document.addEventListener('click', function(e) {
                if (calendarVisible && !dobCalendarPicker.contains(e.target) && e.target !== dobCalendarIcon) {
                    hideDOBCalendar();
                }
            });
            
            // Validate DOB on input
            dobInput.addEventListener('input', function() {
                validateDOB();
                
                // If captcha is active and input changes, show interruption
                if (isCaptchaActive && activeCaptchaType === 'register') {
                    showCaptchaInterruption('register');
                }
            });
            
            // Format DOB input as user types
            dobInput.addEventListener('keydown', function(e) {
                // Allow only numbers and slash
                if (!/[0-9\/]/.test(e.key) && 
                    e.key !== 'Backspace' && 
                    e.key !== 'Delete' && 
                    e.key !== 'Tab' && 
                    e.key !== 'ArrowLeft' && 
                    e.key !== 'ArrowRight') {
                    e.preventDefault();
                }
                
                // Auto-format as DD/MM/YYYY
                if (/[0-9]/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete') {
                    const value = this.value;
                    
                    // Auto-add slash after day
                    if (value.length === 2 && value.indexOf('/') === -1) {
                        this.value = value + '/';
                    }
                    
                    // Auto-add slash after month
                    if (value.length === 5 && value.lastIndexOf('/') === 2) {
                        this.value = value + '/';
                    }
                }
            });
            
            // Update calendar when manual input changes
            dobInput.addEventListener('change', function() {
                if (validateDOB()) {
                    // Parse the manually entered date
                    const dobValue = dobInput.value.trim();
                    const dobRegex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
                    const match = dobValue.match(dobRegex);
                    
                    if (match) {
                        const day = parseInt(match[1], 10);
                        const month = parseInt(match[2], 10) - 1; // Months are 0-indexed in JS
                        const year = parseInt(match[3], 10);
                        
                        const date = new Date(year, month, day);
                        if (date.getFullYear() === year && date.getMonth() === month && date.getDate() === day) {
                            selectedCalendarDate = date;
                            currentCalendarDate = new Date(date);
                            renderCalendar();
                        }
                    }
                }
            });
        }
        
        function showDOBCalendar() {
            // Set current date to today or selected date
            if (selectedCalendarDate) {
                currentCalendarDate = new Date(selectedCalendarDate);
            } else {
                currentCalendarDate = new Date();
                // Set to a reasonable default for age selection (around 25 years old)
                currentCalendarDate.setFullYear(currentCalendarDate.getFullYear() - 25);
            }
            
            renderCalendar();
            dobCalendarPicker.style.display = 'block';
            calendarVisible = true;
        }
        
        function hideDOBCalendar() {
            dobCalendarPicker.style.display = 'none';
            calendarVisible = false;
        }
        
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Month names
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Calendar header
            dobCalendarPicker.innerHTML = `
                <div class="calendar-header">
                    <button class="calendar-nav" id="prevMonth">&lt;</button>
                    <div class="calendar-month-year">${monthNames[month]} ${year}</div>
                    <button class="calendar-nav" id="nextMonth">&gt;</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day">Sun</div>
                    <div class="calendar-day">Mon</div>
                    <div class="calendar-day">Tue</div>
                    <div class="calendar-day">Wed</div>
                    <div class="calendar-day">Thu</div>
                    <div class="calendar-day">Fri</div>
                    <div class="calendar-day">Sat</div>
                </div>
            `;
            
            // Add day numbers
            const calendarGrid = dobCalendarPicker.querySelector('.calendar-grid');
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day disabled';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add day cells
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Check if this day is selected
                if (selectedCalendarDate && 
                    selectedCalendarDate.getDate() === day && 
                    selectedCalendarDate.getMonth() === month && 
                    selectedCalendarDate.getFullYear() === year) {
                    dayElement.classList.add('selected');
                }
                
                // Check if this day is within the valid age range
                const date = new Date(year, month, day);
                const today = new Date();
                const minDate = new Date();
                minDate.setFullYear(today.getFullYear() - MINIMUM_AGE);
                const maxDate = new Date();
                maxDate.setFullYear(today.getFullYear() - MAXIMUM_AGE);
                
                if (date > minDate || date < maxDate) {
                    dayElement.classList.add('disabled');
                } else {
                    dayElement.addEventListener('click', function() {
                        selectDate(new Date(year, month, day));
                    });
                }
                
                calendarGrid.appendChild(dayElement);
            }
            
            // Add event listeners for navigation - FIXED
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');
            
            prevMonthBtn.addEventListener('click', function() {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                renderCalendar();
            });
            
            nextMonthBtn.addEventListener('click', function() {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                renderCalendar();
            });
        }
        
        function selectDate(date) {
            selectedCalendarDate = date;
            
            // Format date as DD/MM/YYYY
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            
            dobInput.value = `${day}/${month}/${year}`;
            hideDOBCalendar();
            validateDOB();
        }
        
        function validateDOB() {
            const dobValue = dobInput.value.trim();
            
            // Check format (DD/MM/YYYY)
            const dobRegex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            const match = dobValue.match(dobRegex);
            
            if (!match) {
                dobInput.classList.add('error');
                dobError.style.display = 'block';
                dobError.textContent = 'Please enter a valid date in DD/MM/YYYY format';
                return false;
            }
            
            const day = parseInt(match[1], 10);
            const month = parseInt(match[2], 10) - 1; // Months are 0-indexed in JS
            const year = parseInt(match[3], 10);
            
            // Check if date is valid
            const date = new Date(year, month, day);
            if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) {
                dobInput.classList.add('error');
                dobError.style.display = 'block';
                dobError.textContent = 'Please enter a valid date';
                return false;
            }
            
            // Check if user is between MINIMUM_AGE and MAXIMUM_AGE years old
            const today = new Date();
            const minDate = new Date();
            minDate.setFullYear(today.getFullYear() - MINIMUM_AGE);
            const maxDate = new Date();
            maxDate.setFullYear(today.getFullYear() - MAXIMUM_AGE);
            
            if (date > minDate) {
                dobInput.classList.add('error');
                dobError.style.display = 'block';
                dobError.textContent = `You must be at least ${MINIMUM_AGE} years old to register`;
                return false;
            }
            
            if (date < maxDate) {
                dobInput.classList.add('error');
                dobError.style.display = 'block';
                dobError.textContent = `You must be younger than ${MAXIMUM_AGE} years old to register`;
                return false;
            }
            
            // All validations passed
            dobInput.classList.remove('error');
            dobError.style.display = 'none';
            return true;
        }
        
        // Password Validation with space check
        function validatePassword() {
            const password = passwordInput.value;
            const strength = calculatePasswordStrength(password);
            const hasSpaces = /\s/.test(password);
            
            if (strength < 60 || hasSpaces) {
                passwordInput.classList.add('error');
                passwordError.style.display = 'block';
                if (hasSpaces) {
                    passwordError.textContent = 'Password cannot contain spaces';
                } else {
                    passwordError.textContent = 'Please enter a strong password';
                }
                return false;
            } else {
                passwordInput.classList.remove('error');
                passwordError.style.display = 'none';
                return true;
            }
        }
        
        // Confirm Password Validation
        confirmPasswordInput.addEventListener('input', function() {
            validateConfirmPassword();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'register') {
                showCaptchaInterruption('register');
            }
        });
        
        function validateConfirmPassword() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (password !== confirmPassword) {
                confirmPasswordInput.classList.add('error');
                confirmPasswordError.style.display = 'block';
                return false;
            } else {
                confirmPasswordInput.classList.remove('error');
                confirmPasswordError.style.display = 'none';
                return true;
            }
        }
        
        // Login Username Validation
        loginUsernameInput.addEventListener('input', function() {
            validateLoginUsername();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'login') {
                showCaptchaInterruption('login');
            }
        });
        
        function validateLoginUsername() {
            const username = loginUsernameInput.value.trim();
            
            if (!username) {
                loginUsernameInput.classList.add('error');
                loginUsernameError.style.display = 'block';
                return false;
            } else {
                loginUsernameInput.classList.remove('error');
                loginUsernameError.style.display = 'none';
                return true;
            }
        }
        
        // Login Password Validation
        loginPasswordInput.addEventListener('input', function() {
            validateLoginPassword();
            
            // If captcha is active and input changes, show interruption
            if (isCaptchaActive && activeCaptchaType === 'login') {
                showCaptchaInterruption('login');
            }
        });
        
        function validateLoginPassword() {
            const password = loginPasswordInput.value;
            
            if (!password) {
                loginPasswordInput.classList.add('error');
                loginPasswordError.style.display = 'block';
                return false;
            } else {
                loginPasswordInput.classList.remove('error');
                loginPasswordError.style.display = 'none';
                return true;
            }
        }
        
        // Remember Me with localStorage
        function saveRememberedUsername() {
            const rememberMe = document.getElementById('rememberMe').checked;
            const username = loginUsernameInput.value.trim();
            
            if (rememberMe && username) {
                // In a real app, you would encrypt this
                localStorage.setItem('rememberedUsername', username);
            } else {
                localStorage.removeItem('rememberedUsername');
            }
        }
        
        function loadRememberedUsername() {
            const rememberedUsername = localStorage.getItem('rememberedUsername');
            if (rememberedUsername) {
                loginUsernameInput.value = rememberedUsername;
                document.getElementById('rememberMe').checked = true;
                
                // Trigger avatar preview if username exists
                if (rememberedUsername.length > 2) {
                    loginUsernameInput.dispatchEvent(new Event('input'));
                }
                
                // Auto-focus password field
                setTimeout(() => {
                    loginPasswordInput.focus();
                }, 100);
            }
        }
        
        // Math Captcha Functions
        function generateCaptchaQuestion() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            const operators = ['+', '-', '*'];
            const operator = operators[Math.floor(Math.random() * operators.length)];
            
            let question = '';
            let answer = 0;
            
            switch(operator) {
                case '+':
                    question = `${num1} + ${num2}`;
                    answer = num1 + num2;
                    break;
                case '-':
                    question = `${num1} - ${num2}`;
                    answer = num1 - num2;
                    break;
                case '*':
                    question = `${num1} × ${num2}`;
                    answer = num1 * num2;
                    break;
            }
            
            return { question, answer };
        }
        
        function showLoginCaptcha() {
            const { question, answer } = generateCaptchaQuestion();
            loginCaptchaQuestion.textContent = `What is ${question}?`;
            loginCaptchaCorrectAnswer = answer;
            loginCaptcha.style.display = 'block';
            loginCaptchaOverlay.style.display = 'block';
            loginCaptchaAnswer.value = '';
            loginSubmit.disabled = true;
            isCaptchaActive = true;
            activeCaptchaType = 'login';
            
            // Add event listener to overlay
            loginCaptchaOverlay.addEventListener('click', handleCaptchaInterruption);
        }
        
        function showRegisterCaptcha() {
            const { question, answer } = generateCaptchaQuestion();
            registerCaptchaQuestion.textContent = `What is ${question}?`;
            registerCaptchaCorrectAnswer = answer;
            registerCaptcha.style.display = 'block';
            registerCaptchaOverlay.style.display = 'block';
            registerCaptchaAnswer.value = '';
            registerSubmit.disabled = true;
            isCaptchaActive = true;
            activeCaptchaType = 'register';
            
            // Add event listener to overlay
            registerCaptchaOverlay.addEventListener('click', handleCaptchaInterruption);
        }
        
        function hideLoginCaptcha() {
            loginCaptcha.style.display = 'none';
            loginCaptchaOverlay.style.display = 'none';
            loginCaptchaInterruption.style.display = 'none';
            loginSubmit.disabled = false;
            isCaptchaActive = false;
            activeCaptchaType = null;
            
            // Remove event listener
            loginCaptchaOverlay.removeEventListener('click', handleCaptchaInterruption);
        }
        
        function hideRegisterCaptcha() {
            registerCaptcha.style.display = 'none';
            registerCaptchaOverlay.style.display = 'none';
            registerCaptchaInterruption.style.display = 'none';
            registerSubmit.disabled = false;
            isCaptchaActive = false;
            activeCaptchaType = null;
            
            // Remove event listener
            registerCaptchaOverlay.removeEventListener('click', handleCaptchaInterruption);
        }
        
        function handleCaptchaInterruption() {
            if (activeCaptchaType === 'login') {
                showCaptchaInterruption('login');
            } else if (activeCaptchaType === 'register') {
                showCaptchaInterruption('register');
            }
        }
        
        function showCaptchaInterruption(type) {
            if (type === 'login') {
                loginCaptcha.style.display = 'none';
                loginCaptchaInterruption.style.display = 'block';
            } else if (type === 'register') {
                registerCaptcha.style.display = 'none';
                registerCaptchaInterruption.style.display = 'block';
            }
        }
        
        // Captcha Event Listeners
        loginCaptchaSubmit.addEventListener('click', function() {
            const userAnswer = parseInt(loginCaptchaAnswer.value);
            
            if (userAnswer === loginCaptchaCorrectAnswer) {
                hideLoginCaptcha();
                submitLoginForm();
            } else {
                loginCaptchaAnswer.classList.add('error');
                showToast('Incorrect answer. Please try again.', 'error');
                setTimeout(() => {
                    loginCaptchaAnswer.classList.remove('error');
                }, 1000);
            }
        });
        
        loginCaptchaRefresh.addEventListener('click', function() {
            const { question, answer } = generateCaptchaQuestion();
            loginCaptchaQuestion.textContent = `What is ${question}?`;
            loginCaptchaCorrectAnswer = answer;
            loginCaptchaAnswer.value = '';
        });
        
        loginCaptchaTryAgain.addEventListener('click', function() {
            loginCaptchaInterruption.style.display = 'none';
            showLoginCaptcha();
        });
        
        registerCaptchaSubmit.addEventListener('click', function() {
            const userAnswer = parseInt(registerCaptchaAnswer.value);
            
            if (userAnswer === registerCaptchaCorrectAnswer) {
                hideRegisterCaptcha();
                submitRegisterForm();
            } else {
                registerCaptchaAnswer.classList.add('error');
                showToast('Incorrect answer. Please try again.', 'error');
                setTimeout(() => {
                    registerCaptchaAnswer.classList.remove('error');
                }, 1000);
            }
        });
        
        registerCaptchaRefresh.addEventListener('click', function() {
            const { question, answer } = generateCaptchaQuestion();
            registerCaptchaQuestion.textContent = `What is ${question}?`;
            registerCaptchaCorrectAnswer = answer;
            registerCaptchaAnswer.value = '';
        });
        
        registerCaptchaTryAgain.addEventListener('click', function() {
            registerCaptchaInterruption.style.display = 'none';
            showRegisterCaptcha();
        });
        
        // Form Submission
        signInForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Apply haptic feedback if available
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
            
            // Validate all fields
            let isValid = true;
            
            if (!validateLoginUsername()) isValid = false;
            if (!validateLoginPassword()) isValid = false;
            
            // Simple validation
            if (isValid) {
                // Show captcha instead of directly submitting
                showLoginCaptcha();
            } else {
                showToast('Please fix the errors in the form', 'error');
            }
        });
        
        function submitLoginForm() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Show loading state
            setButtonLoading(loginSubmit, true);
            
            // Save remembered username if checked
            saveRememberedUsername();
            
            setTimeout(() => {
                showToast('Login successful! Redirecting...', 'success');
                // In a real app, you would send this data to your backend
                
                // Remove loading state
                setButtonLoading(loginSubmit, false);
            }, 2000);
        }
        
        signUpForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Apply haptic feedback if available
            if (navigator.vibrate) {
                navigator.vibrate(20);
            }
            
            // Validate all fields
            let isValid = true;
            
            if (!validateFullName()) isValid = false;
            if (!validateEmail()) isValid = false;
            if (!validateUsername()) isValid = false;
            if (!validateDOB()) isValid = false;
            if (!validatePassword()) isValid = false;
            if (!validateConfirmPassword()) isValid = false;
            
            // Validate terms
            if (!agreeTerms.checked) {
                termsError.style.display = 'block';
                isValid = false;
            } else {
                termsError.style.display = 'none';
            }
            
            // If all validations pass
            if (isValid) {
                // Show captcha instead of directly submitting
                showRegisterCaptcha();
            } else {
                showToast('Please fix the errors in the form', 'error');
            }
        });
        
        function submitRegisterForm() {
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const username = document.getElementById('username').value;
            const dob = document.getElementById('dob').value;
            const password = document.getElementById('password').value;
            
            // Show loading state
            setButtonLoading(registerSubmit, true);
            
            setTimeout(() => {
                showToast('Account created successfully!', 'success');
                // In a real app, you would send this data to your backend
                
                // Remove loading state
                setButtonLoading(registerSubmit, false);
            }, 2000);
        }
        
        // Set button loading state
        function setButtonLoading(button, isLoading) {
            if (isLoading) {
                button.classList.add('btn-loading');
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                button.disabled = true;
            } else {
                button.classList.remove('btn-loading');
                
                if (button.id === 'loginSubmit') {
                    button.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
                } else if (button.id === 'registerSubmit') {
                    button.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
                } else if (button.id === 'forgotPasswordSubmit') {
                    button.innerHTML = '<i class="fas fa-paper-plane"></i> Send Password Reset Link';
                }
                
                button.disabled = false;
            }
        }
        
        // Enhanced Toast Notification
        function showToast(message, type) {
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            
            // Remove any existing show class to reset animation
            toast.classList.remove('show');
            
            // Force reflow to restart animation
            void toast.offsetWidth;
            
            // Add show class to trigger animation
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }
        
        // Add ripple effect to buttons
        document.querySelectorAll('.btn').forEach(button => {
            button.addEventListener('click', function(e) {
                // Remove any existing ripple
                const existingRipple = this.querySelector('.ripple');
                if (existingRipple) {
                    existingRipple.remove();
                }
                
                // Create ripple element
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.6);
                    transform: scale(0);
                    animation: ripple-animation 0.6s linear;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                `;
                
                ripple.classList.add('ripple');
                this.appendChild(ripple);
                
                // Remove ripple after animation completes
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // Add CSS for ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>